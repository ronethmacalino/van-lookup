<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vehicle Assignment Lookup</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      text-align: center;
    }
    .logo {
      max-width: 200px;
      margin-bottom: 20px;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
    }
    .tab-button {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      background-color: #f0f0f0;
      border: none;
      outline: none;
    }
    .tab-button.active {
      background-color: #20531c;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    input, button {
      padding: 10px;
      width: 100%;
      margin-top: 10px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <img src="C.png" alt="Logo" class="logo" />
  <h2>Vehicle Assignment Lookup</h2>

  <div class="tabs">
    <button class="tab-button active" onclick="showTab('day14')">August 14</button>
    <button class="tab-button" onclick="showTab('day15')">August 15</button>
    <button class="tab-button" onclick="showTab('day16')">August 16</button>
    <button class="tab-button" onclick="showTab('day17')">August 17</button>
  </div>

  <div id="day14" class="tab-content active">
    <input type="text" id="input14" placeholder="Enter Name" />
    <button onclick="findVehicle('August 14', 'result14', 'input14')">Check Assignment</button>
    <div id="result14" class="result">Loading data...</div>
  </div>
  <div id="day15" class="tab-content">
    <input type="text" id="input15" placeholder="Enter Name" />
    <button onclick="findVehicle('August 15', 'result15', 'input15')">Check Assignment</button>
    <div id="result15" class="result">Loading data...</div>
  </div>
  <div id="day16" class="tab-content">
    <input type="text" id="input16" placeholder="Enter Name" />
    <button onclick="findVehicle('August 16', 'result16', 'input16')">Check Assignment</button>
    <div id="result16" class="result">Loading data...</div>
  </div>
  <div id="day17" class="tab-content">
    <input type="text" id="input17" placeholder="Enter Name" />
    <button onclick="findVehicle('August 17', 'result17', 'input17')">Check Assignment</button>
    <div id="result17" class="result">Loading data...</div>
  </div>

  <script>
    const vehicleData = {};

    function normalize(str) {
      return str.toLowerCase().replace(/\s+/g, ' ').trim();
    }

    async function loadVehicleData() {
      const response = await fetch('https://script.google.com/macros/s/AKfycbyq7r_xKPYHM_ndjYQBrD8K_UZX_r2DLynuROtJ2g5mU2IKTVmU92MkPvmhyznWgWpU/exec');
      const data = await response.json();

      ["August 14", "August 15", "August 16", "August 17"].forEach(day => {
        vehicleData[day] = {};
        data[day].forEach(entry => {
          if (entry["Employee Name"]) {
            vehicleData[day][normalize(entry["Employee Name"])] = entry;
          }
        });
        document.getElementById(`result${day.slice(-2)}`).textContent = "Ready to search.";
      });
    }

    function findVehicle(day, resultId, inputId) {
      const input = document.getElementById(inputId).value.trim();
      const normalized = normalize(input);
      const dataSet = vehicleData[day];
      const resultDiv = document.getElementById(resultId);

      if (!input) {
        resultDiv.textContent = "Please enter a name.";
        return;
      }

      let foundKey = Object.keys(dataSet).find(k => normalize(k) === normalized);

      if (!foundKey) {
        foundKey = Object.keys(dataSet).find(k => {
          const originalName = normalize(k);
          return originalName.includes(normalized) || normalized.includes(originalName);
        });
      }

      if (foundKey) {
        const entry = dataSet[foundKey];
        resultDiv.innerHTML = `Plate & Model: ${entry["Van Plate Number"] || "N/A"} ${entry["Van Model"] || ""}<br>
                               Driver: ${entry["Van Driver"] || "N/A"} (${entry["Driver Number"] || "N/A"})<br>
                               Van Leader: ${entry["Van POC"] || "N/A"}`;
      } else {
        const suggestions = Object.keys(dataSet)
          .filter(k => k.includes(normalized.split(" ")[0]))
          .slice(0, 3)
          .map(k => `<li>${dataSet[k]["Employee Name"]}</li>`)
          .join("");

        resultDiv.innerHTML = `No assignment found for "${input}".<br>` +
                              (suggestions ? `Did you mean:<ul>${suggestions}</ul>` : "");
      }
    }

    function showTab(tabId) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');

      document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    window.addEventListener('DOMContentLoaded', loadVehicleData);
  </script>
</body>
</html>
